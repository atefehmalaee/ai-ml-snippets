# ---------------------------------------------------------
# ðŸš€ GitLab CI/CD pipeline for AI/ML Snippets
# Stages: lint â†’ test â†’ build â†’ deploy
# ---------------------------------------------------------

stages:
  - lint
  - test
  - build
  - deploy

variables:
  PIP_CACHE_DIR: "$CI_PROJECT_DIR/.cache/pip"
  PYTHONUNBUFFERED: "1"

before_script:
  - python3 -m venv venv
  - source venv/bin/activate
  - pip install --upgrade pip
  - pip install -r requirements.txt || true

lint:
  stage: lint
  script:
    - pip install black flake8 isort
    - black --check .
    - flake8 .
    - isort . --check-only
  allow_failure: false

test:
  stage: test
  script:
    - pip install pytest pytest-cov
    - pytest --maxfail=1 --disable-warnings -q
  coverage: '/TOTAL\s+\d+\s+\d+\s+(\d+%)/'

build:
  stage: build
  script:
    - docker build -f mlops/docker/Dockerfile.dev -t ai-ml-snippets-dev .
    - echo "âœ… Build completed"

deploy:
  stage: deploy
  script:
    - echo "ðŸš€ Deploying application..."
  when: manual
